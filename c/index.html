<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<noscript>
	<meta http-equiv="refresh" content="600; URL=./index.html" />
</noscript>
<title>Liste des absences du Ceria</title>
<style>
iframe { border:none; }
html, body {
	height:100%;
	width:100%;
	margin:0;
	padding:0;
}
.main {
	display:-ms-grid;
	-ms-grid-columns: min-content 1fr;
	-ms-grid-rows: 1fr min-content;
	display:grid;
	grid-template-columns: min-content 1fr;
	grid-template-rows: 1fr min-content;
	position:absolute;
}

.cell {
	width:100%;
	height:100%;
}
.feed {
	-ms-grid-row:1;
	-ms-grid-column:1;
	grid-row:1;
	grid-column:1;
	
	max-width:500px;
	width:50vw;
	overflow-y:scroll;
}
.site {
	-ms-grid-row:1;
	-ms-grid-row-span:2;
	-ms-grid-column:2;
	grid-row:1/span 2;
	grid-column:2;
}
.console {
	-ms-grid-row:2;
	-ms-grid-column:1;
	grid-row:2;
	grid-column:1;
	
	height:50px;
	overflow-y:auto;
}

.yesjs { visibility:visible; }
</style>
<noscript><style>
.yesjs { visibility:hidden; }
</style></noscript>
</head>
<body class="main">
<iframe id="fb" class="cell feed" data-src="https://www.facebook.com/plugins/page.php?href=https://www.facebook.com/456811884398747&tabs=timeline&hide_cover=true&show_facepile=false&hide_cta=false&small_header=true&adapt_container_width=false" sandbox="allow-same-origin allow-scripts"></iframe>
<iframe id="profs" class="cell site" src="https://www.whatismyreferer.com" data-src="http://www.ceria.be/irl/index.php?option=com_content&view=article&id=114&Itemid=129" sandbox=""></iframe>
<div class="cell console">
	<noscript>
	Javascript est désactivé<br />
	Cette page s'auto-rafraîchira dans 10 minutes
	</noscript>
	<span id="console" class="yesjs">
	Première ligne de la console
	</span>
</div>
<script>
(function() {
	"use strict";
	// Log dans la page web
	let m_console = document.getElementById('console');
	const log = function(p_str) {	
		let start = m_console.firstChild;
		if (start)
			m_console.insertBefore(start = document.createElement("br"), m_console.firstChild);
		const now = new Date();
		const pad = function(p_val) {return ('00' + p_val).slice(-2)};
		p_str = '['+pad(now.getHours())+':'+pad(now.getMinutes())+':'+pad(now.getSeconds())+'] ' + p_str;
		m_console.insertBefore(document.createTextNode(p_str), start);
	};
	
	const fbElement = document.getElementById('fb');
	
	// Calcul redimensionnement fb
	let m_fbSrc = fbElement.getAttribute('data-src');	
	let m_fbWidth = -1, m_fbHeight = -1;
	const resizeFb = function(){
		const style = getComputedStyle(fbElement);
		let width = parseInt(style['width']);
		// Limites de largeur dans l'API facebook
		if (width < 170) width = 170;
		else if (width > 500) width = 500;
		
		// Hauteur max dans l'API facebook
		let height = parseInt(style['height']);
		if (height < 70) height = 70;
		
		if (m_fbWidth === width && m_fbHeight === height) return;	
		m_fbWidth = width;
		m_fbHeight = height;
		
		fbElement.src = m_fbSrc + '&width='+width + '&height='+height;
		log('Facebook '+width+'x'+height);
	};
	
	// Trigger redimensionnement fb
	let m_fbTimer;
	addEventListener('resize', function() {
			if (m_fbTimer) clearTimeout(m_fbTimer);
			m_fbTimer = setTimeout(resizeFb, 5000);
		});
	resizeFb();
	
	// Ajout favicon dans startup.html ou index.html
	const link = parent.document.createElement('link');
	link.rel = 'icon';
	link.href = 'http://www.ceria.be/irl/templates/ja_purity/favicon.ico';
	link.type = 'image/x-icon';
	parent.document.head.appendChild(link);
	
	// Rechargement
	const profsElement = document.getElementById('profs');
	setInterval(function(iframe) {		
		const src = iframe.src;
		iframe.src = 'about:blank';
		iframe.src = src;
		log('Fenêtre Ceria rechargée');
	}, 600000, profsElement);
	
	// Suppression données inutiles
	fbElement.removeAttribute('data-src');
	m_console.removeAttribute('id');
	fbElement.removeAttribute('id');
	profsElement.removeAttribute('id');
})();
</script>
</body>
</html>
