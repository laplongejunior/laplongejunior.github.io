<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="referrer" content="never" />
<meta name="referrer" content="no-referrer" />
<noscript>
	<meta http-equiv="refresh" content="600" />
</noscript>
<title>Liste des absences du Ceria</title>
<style>iframe{border:none}body,html{height:100%;width:100%;margin:0;padding:0}.main{position:absolute;display:-ms-grid;display:grid;-ms-grid-columns:1fr 1fr;grid-template-columns:1fr 1fr;-ms-grid-rows:1fr 50px;grid-template-rows:1fr 50px}@media all and (max-width:340px){.main{-ms-grid-columns:170px 1fr;grid-template-columns:170px 1fr}}@media all and (min-width:1000px){.main{-ms-grid-columns:500px 1fr;grid-template-columns:500px 1fr}}@media all and (max-height:120px){.main{-ms-grid-rows:70px 1fr;grid-template-rows:70px 1fr}}.cell{width:100%;height:100%}.feed{-ms-grid-row:1;-ms-grid-column:1;grid-row:1;grid-column:1;overflow-y:scroll}.site{-ms-grid-row:1;-ms-grid-row-span:2;-ms-grid-column:2;grid-row:1/span 2;grid-column:2}.console{-ms-grid-row:2;-ms-grid-column:1;grid-row:2;grid-column:1;overflow-y:auto}</style>
</head>
<body class="main">
<iframe id="fb" class="cell feed" data-src="https://www.facebook.com/plugins/page.php?href=https://www.facebook.com/456811884398747&tabs=timeline&hide_cover=true&show_facepile=false&de_cta=false&small_header=true&adapt_container_width=false" sandbox="allow-same-origin allow-scripts"></iframe>
<iframe id="profs" class="cell site" src="https://translate.googleusercontent.com/translate_c?depth=2&hl=fr&nv=1&rurl=translate.google.com&sl=auto&sp=nmt4&tl=en&u=http://www.ceria.be/irl/index.php%3Foption%3Dcom_content%26view%3Darticle%26id%3D114%26Itemid%3D129&xid=17259,15700021,15700186,15700190,15700256,15700259,15700262,15700265&usg=ALkJrhh8D5YKBtRDr-JzwkNoc95-O86hnw" /*sandbox=""*/></iframe>
<div id="console" class="cell console">
	<noscript>
	Javascript est désactivé<br />
	Cette page s'auto-rafraîchira dans 10 minutes
	</noscript>
</div>
<script>
(function() {
	"use strict"
	// Log dans la page web
	let m_console = document.getElementById('console')
	
	const log = function(p_str) {	
		let start = m_console.firstChild
		if (start)
			m_console.insertBefore(start = document.createElement("br"), m_console.firstChild)
		const now = new Date()
		const pad = function(p_val) {return ('00' + p_val).slice(-2)}
		p_str = '['+pad(now.getHours())+':'+pad(now.getMinutes())+':'+pad(now.getSeconds())+'] ' + p_str
		m_console.insertBefore(document.createTextNode(p_str), start)
	}
	log('Console prête')
	
	const fbElement = document.getElementById('fb')
	
	// Calcul redimensionnement fb
	const m_fbSrc = fbElement.getAttribute('data-src')
	let m_prevWidth = -1, m_prevHeight = -1
	const refreshFb = function() {
		const style = getComputedStyle(fbElement)
		let width = parseInt(style['width'])
		let height = parseInt(style['height'])
	
		if (m_prevWidth === width && m_prevHeight === height)
			return
		m_prevWidth = width
		m_prevHeight = height
		
		fbElement.src = m_fbSrc + '&width='+width + '&height='+height
		log('Facebook '+width+'x'+height)
	}
	
	// Trigger redimensionnement fb
	let m_fbTimer
	const onResize = function() {
			if (m_fbTimer) clearTimeout(m_fbTimer)
			m_fbTimer = setTimeout(refreshFb, 5000)
		}
	addEventListener('load', onResize)
	addEventListener('resize', onResize)

	// En local, Chrome n'autorise pas à éditer depuis l'iframe
	let isTop
	try { isTop = (window === top) }
	catch (e) { isTop = false }
	if (isTop) {
		const link = document.createElement('link')
		link.rel = "icon"
		link.href = 'http://www.ceria.be/irl/templates/ja_purity/favicon.ico'
		document.head.appendChild(link)
	}
	
	// Rechargement
	const profsElement = document.getElementById('profs')
	setInterval(function(iframe) {
		const src = iframe.src
		iframe.src = 'about:blank'
		iframe.src = src
		log('Fenêtre Ceria rechargée')
	}, 600000, profsElement)

	// Suppression données inutiles
	fbElement.removeAttribute('data-src')
	m_console.removeAttribute('id')
	fbElement.removeAttribute('id')
	profsElement.removeAttribute('id')
})()
</script>
</body>
</html>
