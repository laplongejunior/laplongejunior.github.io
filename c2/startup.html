<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="referrer" content="never" />
<meta name="referrer" content="no-referrer" />
<title>Liste des absences du Ceria (mode startup)</title>
<script src="https://laplongejunior.github.io/holiday.min.js"></script>
<script>
(function() {
	"use strict";
	let exit, el;
	
	// Si X est une fonction retournant TRUE, rediriger la fenêtre en cours
	if (typeof window.X === 'function' && !window.X())
		exit = window;
	else {
		// Popup vide par défaut afin de configurer la sécurité avant redirection
		exit = open('about:blank', '_blank');
		if (!exit) return;
		// Sécurité #1 : empêcher la nouvelle fenêtre de rediriger notre webapp
		exit.opener = null;
		
		// Sécurité #2 : préciser que la fenêtre à rediriger ne doit pas inclure le referer
		const addReferer = function(content) {
			el = exit.document.createElement('meta');
			el.name = 'referrer';
			el.content = content;
			exit.document.head.appendChild(el);
		};
		// Sécurité #2+1/2 : ancien referrer pour IE, puis l'officiel pour les autres
		addReferer('never','no-referrer');

		// En local, Chrome n'autorise pas l'iframe a manipuler le parent
		const link = document.createElement('link');
		// Shortcut pour support IE
		link.rel = 'shortcut icon';
		link.href = 'http://www.ceria.be/irl/templates/ja_purity/favicon.ico';
		link.type = 'image/x-icon';
		document.head.appendChild(link);
	}
	
	// Supprimer la seule modification apportée à l'objet global
	delete window.X;
	
	exit.location.replace('https://whatismyreferer.com');
	/*
	const doc = exit.document;	
	// Rajouter à la fenêtre à rediriger un script de redirection, fonctionne même sur about:blank avec IE11
	el = doc.createElement('script');
	el.appendChild(doc.createTextNode("location.replace('"+'https://www.google.be'+"')"));
	doc.head.appendChild(el);
	*/
})();
</script>
<style>
html, body {
	height:100%;
	width:100%;
	margin:0;
	padding:0;
}
iframe {
	border:none;
	height:100%;
	width:100%;
	position:absolute;
}
</style>
</head>
<body>
<iframe id="content" src="./index.html"></iframe>
</body>
</html>