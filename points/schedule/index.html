<!DOCTYPE html>
<html lang="fr">
<head>
<style>
html, body {
	height:100%;
	width:100%;
	margin:0;
	padding:0;
}
.text {
	width:90%;
	height:90%;
}
</style>
<meta charset="utf-8" />
<title>Test TW schedule</title>
</head>
<body>
<!--
<input type="number" id="minYear" value="2017"></input>
<input type="number" id="maxYear" value="2030"></input>
<button id="run">Click here to generate</button>
-->
<br/>
<label>Result code</label>
<br/>
<textarea class="text" id="output"></textarea>
<script>
"use strict";
/*document.getElementById('run').addEventListener('click', */(function(){
	// Number between 0 and 4 in case cycle drifts due to complications
	const RSS_OFFSET = 1;

	const DAY_MS = 1000*60*60*24;
	let epoch = new Date();
	let today = new Date(epoch.getCurrentYear()+"-"+epoch.getMonth()+"-"+epoch.getDay());
	today = new Date(today.getTime()-DAY_MS*1)
	console.log(today);
	epoch = new Date("1970-01-01");
	console.log(epoch);
	
	const result = new Map();

	for (int day = 0; day<8; day++) {
		const currentDay = new Date(today.getTime()+ DAY_MS*day);
		const UTCreset = (minutes)=>{
			return new Date(currentDay.getTime()+minutes*60*1000);
		};
		
		const diff = (currentDay-epoch) / DAY_MS;
	
		const rssIndex = ((diff+RSS_OFFSET)%4), doubleDip = (rssIndex%2);
		result.set(UTCreset(2*60), "Reset+2 for 1st rss : "+ (rssIndex<2?"Food":"Oil"));
	
		for (let time = 4; time < 24; time +=8) {
			reset.set(TCreset(time*60), "Reset+4+"+time+" for WB flag");
			reset.set(TCreset((time+1)*60), "Reset+4+"+time+"+1 for gathering flag");
		}
		
		if (doubleDip === 0) {
			result.set(TCreset(-1*60), "2nd rss : " + (rssIndex===2?"Food":"Oil"));
		}
		// Food+Oil
		// Food
		// Oil+Food
		// Oil
	}
	
	let txt = "Debug example";
	for (var [date,name] of new Map([...result.entries()].sort(function(a,b){return a[0]-b[0];})))
		txt += "\n"+name+","+date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate();
	document.getElementById('output').value = txt;
}/*);*/)();
</script>
</body>
</html>
